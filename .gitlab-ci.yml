include:
    - project: "epi2melabs/ci-templates"
      file: "wf-containers.yaml"

variables:
    NF_WORKFLOW_OPTS: "--fastq test_data/fastq --samples test_data/sample_sheet.csv"
    NF_IGNORE_PROCESSES: "checkSampleSheet,combineGenotypeSummaries,genotypeSummary,report_no_data"
    CI_FLAVOUR: "new"


docker-run:
    artifacts:
        when: always
        exclude:
          - ${CI_PROJECT_NAME}/workspace/**/*
    parallel:
        matrix:
            - MATRIX_NAME: ["Midnight-ONT/V1", "Midnight-ONT/V2", "ARTIC/V4.1", "ARTIC/V5.3.2", "Midnight-IDT/V2", "NEB-VarSkip/v2"]
    rules:
        - if: ($CI_COMMIT_BRANCH == null || $CI_COMMIT_BRANCH == "dev-template")
          when: never
        - if: $MATRIX_NAME == "Midnight-ONT/V1"
          variables:
              NF_WORKFLOW_OPTS: " --fastq test_data/fastq --samples test_data/sample_sheet.csv --scheme_name SARS-CoV-2 --scheme_version Midnight-ONT/V1"
        - if: $MATRIX_NAME == "Midnight-ONT/V2"
          variables:
              NF_WORKFLOW_OPTS: " --fastq test_data/fastq --samples test_data/sample_sheet.csv --scheme_name SARS-CoV-2 --scheme_version Midnight-ONT/V2"
        - if: $MATRIX_NAME == "ARTIC/V4.1"
          variables:
              NF_WORKFLOW_OPTS: " --fastq test_data/fastq --samples test_data/sample_sheet.csv --scheme_name SARS-CoV-2 --scheme_version ARTIC/V4.1"
        - if: $MATRIX_NAME == "ARTIC/V5.3.2"
          variables:
              NF_WORKFLOW_OPTS: " --fastq test_data/fastq --samples test_data/sample_sheet.csv --scheme_name SARS-CoV-2 --scheme_version ARTIC/V5.3.2"
        - if: $MATRIX_NAME == "Midnight-IDT/V2"
          variables:
              NF_WORKFLOW_OPTS: " --fastq test_data/fastq --samples test_data/sample_sheet.csv --scheme_name SARS-CoV-2 --scheme_version Midnight-IDT/V2"
        - if: $MATRIX_NAME == "NEB-VarSkip/v2"
          variables:
              NF_WORKFLOW_OPTS: " --fastq test_data/fastq --samples test_data/sample_sheet.csv --scheme_name SARS-CoV-2 --scheme_version NEB-VarSkip/v2"
